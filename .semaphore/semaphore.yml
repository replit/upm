---
version: v1.0
name: UPM
agent:
  machine:
    type: e1-standard-2
  containers:
    - name: main
      image: ubuntu2004

blocks:
  - name: setup
    dependencies: []
    task:
      jobs:
        - name: install nix
          commands:
            - >-
              curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix
              | sh -s -- install linux --no-confirm --logger compact
        - name: checkout pr
          commands:
            - checkout
            - git switch -c pr
  - name: build
    dependencies: [setup]
    task:
      jobs:
        - name: nix build
          commands:
            - nix build
